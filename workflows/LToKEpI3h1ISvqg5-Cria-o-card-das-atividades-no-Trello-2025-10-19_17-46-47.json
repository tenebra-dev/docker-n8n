{
  "exportedAt": "2025-10-19_17-46-47",
  "exportMethod": "n8n-cli",
  "originalId": "LToKEpI3h1ISvqg5",
  "workflow": {
    "createdAt": "2025-10-17T20:23:36.563Z",
    "updatedAt": "2025-10-19T20:45:16.972Z",
    "id": "LToKEpI3h1ISvqg5",
    "name": "Cria o card das atividades no Trello",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          0,
          0
        ],
        "id": "e8b1cbf1-bab5-4620-852f-002dcf2321d8",
        "name": "Executar"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1UvxkV7rfTpKkJyl8fiJ6Dod6VJE8iHygwhPO283nnvY",
            "mode": "list",
            "cachedResultName": "entregas_20251014113404",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1UvxkV7rfTpKkJyl8fiJ6Dod6VJE8iHygwhPO283nnvY/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1525225853,
            "mode": "list",
            "cachedResultName": "Eleve",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1UvxkV7rfTpKkJyl8fiJ6Dod6VJE8iHygwhPO283nnvY/edit#gid=1525225853"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          208,
          0
        ],
        "id": "e2146c93-f0fb-4882-8cc5-3caa48ea672e",
        "name": "Busca Atividades na Planilha",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "fZL8A9ySuVB3GmXb",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Mapeamento dos STATUS para as listas do Trello\nconst statusParaLista = {\n  // Backlog - Para entregas nÃ£o iniciadas e novos projetos\n  \"Entrega nÃ£o iniciada\": \"68efda56390f75b3d28e518c\",\n  \"NÃ£o iniciado\": \"68efda56390f75b3d28e518c\",\n  \"Backlog\": \"68efda56390f75b3d28e518c\",\n  \n  // Andamento - Para atividades em desenvolvimento\n  \"Em andamento\": \"68efda56390f75b3d28e518d\",\n  \"Desenvolvimento\": \"68efda56390f75b3d28e518d\",\n  \"Andamento\": \"68efda56390f75b3d28e518d\",\n  \"ExecuÃ§Ã£o\": \"68efda56390f75b3d28e518d\",\n  \n  // Parados (Aguardando Cliente) - Para bloqueios do cliente\n  \"Aguardando cliente\": \"68efda56390f75b3d28e518e\",\n  \"Aguardando aprovaÃ§Ã£o\": \"68efda56390f75b3d28e518e\",\n  \"Aguardando informaÃ§Ã£o\": \"68efda56390f75b3d28e518e\",\n  \"Parado cliente\": \"68efda56390f75b3d28e518e\",\n  \n  // Pausados (Clientes TOTVS) - EspecÃ­fico para TOTVS\n  \"Pausado TOTVS\": \"68efda56390f75b3d28e518f\",\n  \"Aguardando TOTVS\": \"68efda56390f75b3d28e518f\",\n  \n  // Projetos Travados - Para problemas crÃ­ticos\n  \"Travado\": \"68efda56390f75b3d28e5190\",\n  \"Bloqueado\": \"68efda56390f75b3d28e5190\",\n  \"Problema crÃ­tico\": \"68efda56390f75b3d28e5190\",\n  \n  // Em fase de finalizaÃ§Ã£o - Para testes e ajustes finais\n  \"Testes\": \"68efda56390f75b3d28e5191\",\n  \"Ajustes finais\": \"68efda56390f75b3d28e5191\",\n  \"FinalizaÃ§Ã£o\": \"68efda56390f75b3d28e5191\",\n  \"QA\": \"68efda56390f75b3d28e5191\",\n  \n  // GoLive - Para entregues e concluÃ­dos\n  \"ConcluÃ­do\": \"68efda56390f75b3d28e5192\",\n  \"Entregue\": \"68efda56390f75b3d28e5192\",\n  \"GoLive\": \"68efda56390f75b3d28e5192\",\n  \"Finalizado\": \"68efda56390f75b3d28e5192\"\n};\n\n// FunÃ§Ã£o para converter data do formato brasileiro\nfunction converterData(dataString) {\n  if (!dataString || dataString === '') return null;\n  \n  try {\n    // Formato: DD/MM/YYYY\n    const partes = dataString.split('/');\n    if (partes.length === 3) {\n      const dia = parseInt(partes[0]);\n      const mes = parseInt(partes[1]) - 1; // MÃªs Ã© 0-indexed\n      const ano = parseInt(partes[2]);\n      \n      const data = new Date(ano, mes, dia);\n      // Verificar se a data Ã© vÃ¡lida\n      if (!isNaN(data.getTime())) {\n        return data.toISOString();\n      }\n    }\n    return null;\n  } catch (error) {\n    console.log('Erro ao converter data:', dataString, error);\n    return null;\n  }\n}\n\n// FunÃ§Ã£o para formatar a descriÃ§Ã£o do card\nfunction criarDescricao(dados) {\n  return `\nðŸ“‹ **ENTREGA:** ${dados[\"ID ENTREGA\"] || \"N/A\"}\nðŸ¢ **CLIENTE:** ${dados[\"NOME FANTASIA\"] || \"N/A\"} (${dados[\"CNPJ CLIENTE\"] || \"N/A\"})\nðŸ“Š **OPORTUNIDADE:** ${dados[\"ID OPORTUNIDADE\"] || \"N/A\"}\nðŸ‘¤ **VENDEDOR:** ${dados[\"VENDEDOR\"] || \"N/A\"}\nðŸ‘¨â€ðŸ’¼ **LÃDER PMO:** ${dados[\"LIDER PMO\"] || \"N/A\"}\n\nðŸ“ **DESCRIÃ‡ÃƒO:**\n${dados[\"DESCRIÃ‡ÃƒO\"] || \"Sem descriÃ§Ã£o\"}\n\nâ° **HORAS PREVISTAS:** ${dados[\"HORAS PREVISTAS DA ENTREGA\"] || \"N/A\"}\nâ±ï¸ **HORAS REALIZADAS:** ${dados[\"HORAS REALIZADAS DA ENTREGA\"] || \"N/A\"}\nâš–ï¸ **SALDO:** ${dados[\"SALDO\"] || \"N/A\"}\n\nðŸ“… **DATAS:**\nâ€¢ InÃ­cio: ${dados[\"DATA INICIO\"] || \"NÃ£o definido\"}\nâ€¢ Fim Previsto: ${dados[\"DATA FIM PREVISTO\"] || \"NÃ£o definido\"}\nâ€¢ Fim Efetivo: ${dados[\"DATA FIM EFETIVA\"] || \"NÃ£o definido\"}\nâ€¢ Ãšltima MovimentaÃ§Ã£o: ${dados[\"DATA DA ÃšLTIMA MOVIMENTAÃ‡ÃƒO\"] || \"N/A\"}\n\nðŸ”„ **ETAPA ATUAL:** ${dados[\"ETAPA ATUAL\"] || \"NÃ£o definida\"}\nðŸ“Š **STATUS:** ${dados[\"STATUS\"] || \"NÃ£o definido\"}\n\n---\n*Atualizado em: ${new Date().toLocaleDateString('pt-BR')}*\n`.trim();\n}\n\n// Processamento principal\nconst items = $input.all();\nconst processedItems = [];\n\nfor (const item of items) {\n  const json = item.json;\n  \n  try {\n    // Determinar a lista baseada no status\n    const status = json[\"STATUS\"] || \"Entrega nÃ£o iniciada\";\n    const listaId = statusParaLista[status] || statusParaLista[\"Entrega nÃ£o iniciada\"];\n    \n    // Converter datas\n    const dataInicio = converterData(json[\"DATA INICIO\"]);\n    const dataFimPrevisto = converterData(json[\"DATA FIM PREVISTO\"]);\n    const dataFimEfetiva = converterData(json[\"DATA FIM EFETIVA\"]);\n    \n    // Criar nome do card (limitar tamanho)\n    const nomeBase = `${json[\"ID ENTREGA\"] || \"SEM_ID\"} - ${json[\"DESCRIÃ‡ÃƒO\"] || \"Sem descriÃ§Ã£o\"}`;\n    const nomeCard = nomeBase.length > 150 ? nomeBase.substring(0, 147) + \"...\" : nomeBase;\n    \n    // Criar item processado\n    processedItems.push({\n      listaId: listaId,\n      nomeCard: nomeCard,\n      descricao: criarDescricao(json),\n      due: dataFimPrevisto, // Data de vencimento no Trello\n      start: dataInicio,    // Data de inÃ­cio no Trello\n      statusOriginal: status,\n      idEntrega: json[\"ID ENTREGA\"] || \"N/A\",\n      idOportunidade: json[\"ID OPORTUNIDADE\"] || \"N/A\",\n      \n      // Manter dados originais para referÃªncia\n      dadosOriginais: json\n    });\n    \n  } catch (error) {\n    console.log(`Erro ao processar item ${json[\"ID ENTREGA\"]}:`, error);\n    // Continue processando outros items mesmo se um falhar\n  }\n}\n\n// Log para debug\nconsole.log(`Processados ${processedItems.length} items`);\nconsole.log(\"DistribuiÃ§Ã£o por lista:\", processedItems.reduce((acc, item) => {\n  acc[item.listaId] = (acc[item.listaId] || 0) + 1;\n  return acc;\n}, {}));\n\nreturn processedItems;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          400,
          0
        ],
        "id": "2f2fa494-26b6-4793-aa54-8c030b2b269b",
        "name": "Codigo em JS"
      },
      {
        "parameters": {
          "listId": "={{ $json.listaId }}",
          "name": "={{ $json.nomeCard }}",
          "description": "={{ $json.descricao }}",
          "additionalFields": {
            "due": "={{ $json.due }}"
          }
        },
        "type": "n8n-nodes-base.trello",
        "typeVersion": 1,
        "position": [
          608,
          0
        ],
        "id": "c19728e4-2c11-48aa-8e27-909877aca8a1",
        "name": "Cria os cards",
        "credentials": {
          "trelloApi": {
            "id": "ENG2qAmToy7aHVHS",
            "name": "Trello account"
          }
        }
      }
    ],
    "connections": {
      "Executar": {
        "main": [
          [
            {
              "node": "Busca Atividades na Planilha",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca Atividades na Planilha": {
        "main": [
          [
            {
              "node": "Codigo em JS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Codigo em JS": {
        "main": [
          [
            {
              "node": "Cria os cards",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true
    },
    "pinData": {},
    "versionId": "23324b86-ec37-49a8-8912-8d5c083333b1",
    "triggerCount": 0,
    "tags": [],
    "shared": [
      {
        "createdAt": "2025-10-17T20:23:36.563Z",
        "updatedAt": "2025-10-17T20:23:36.563Z",
        "role": "workflow:owner",
        "workflowId": "LToKEpI3h1ISvqg5",
        "projectId": "aOe9xFfe8tM1dmBL",
        "project": {
          "createdAt": "2025-10-17T20:19:31.987Z",
          "updatedAt": "2025-10-17T20:20:53.343Z",
          "id": "aOe9xFfe8tM1dmBL",
          "name": "Guilherme Soares <guilherme.soares@worknow.com.br>",
          "type": "personal",
          "icon": null,
          "description": null
        }
      }
    ]
  }
}
